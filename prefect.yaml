name: pipelines-rj-smas
prefect-version: 3.0.0

# 3. Pull (Define o diretório de trabalho no container)
pull:
  - prefect.deployments.steps.set_working_directory:
      directory: /app

# 4. Definições dos Deployments
deployments:
  # ---------------------------------------------------------------------------
  # Abordagem
  # ---------------------------------------------------------------------------
  - name: abordagem-staging
    entrypoint: pipelines/arcgis/abordagem/flows.py:abordagem_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: staging
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["staging", "arcgis"]

  - name: abordagem-prod
    entrypoint: pipelines/arcgis/abordagem/flows.py:abordagem_flow
    schedule:
      cron: "0 */6 * * *"
      timezone: "America/Sao_Paulo"
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: prod
          PREFECT_EVENTS_ENABLED: "false"
          PREFECT_SERVER_EVENTS_ENABLED: "false"
          PREFECT_EVENTS_MESSAGING_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_PERSISTER_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_LOGGER_ENABLED: "false"
          PREFECT_SERVER_EVENTS_STREAM_OUT_ENABLED: "false"
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["prod", "arcgis"]

  # ---------------------------------------------------------------------------
  # Bolsa Família
  # ---------------------------------------------------------------------------
  - name: bolsa-familia-staging
    entrypoint: pipelines/bolsa_familia/flows.py:bolsa_familia_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: staging
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["staging", "bolsa-familia"]

  - name: bolsa-familia-prod
    entrypoint: pipelines/bolsa_familia/flows.py:bolsa_familia_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: prod
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["prod", "bolsa-familia"]

  # ---------------------------------------------------------------------------
  # Acolherio
  # ---------------------------------------------------------------------------
  - name: acolherio-staging
    entrypoint: pipelines/acolherio/flows.py:acolherio_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: staging
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["staging", "acolherio"]

  - name: acolherio-prod
    entrypoint: pipelines/acolherio/flows.py:acolherio_flow
    schedule:
      cron: "0 1 * * *"
      timezone: "America/Sao_Paulo"
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: prod
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["prod", "acolherio"]

  # ---------------------------------------------------------------------------
  # equipamento
  # ---------------------------------------------------------------------------
  - name: equipamento-staging
    entrypoint: pipelines/arcgis/equipamento/flows.py:equipamento_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: staging
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["staging", "equipamento"]

  - name: equipamento-prod
    entrypoint: pipelines/arcgis/equipamento/flows.py:equipamento_flow
    schedule:
      cron: "0 1 * * *"
      timezone: "America/Sao_Paulo"
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          MODE: prod
          PREFECT_EVENTS_ENABLED: "false"
          PREFECT_SERVER_EVENTS_ENABLED: "false"
          PREFECT_EVENTS_MESSAGING_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_PERSISTER_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_LOGGER_ENABLED: "false"
          PREFECT_SERVER_EVENTS_STREAM_OUT_ENABLED: "false"
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["prod", "equipamento"]

  # ---------------------------------------------------------------------------
  # cras_cas_poligonos
  # ---------------------------------------------------------------------------
  - name: cras_cas_poligonos-staging
    entrypoint: pipelines/arcgis/cras_cas_poligonos/flows.py:cras_cas_poligonos_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: staging
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["staging", "cras_cas_poligonos"]

  - name: cras_cas_poligonos-prod
    entrypoint: pipelines/arcgis/cras_cas_poligonos/flows.py:cras_cas_poligonos_flow
    schedule:
      cron: "0 1 * * *"
      timezone: "America/Sao_Paulo"
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          MODE: prod
          PREFECT_EVENTS_ENABLED: "false"
          PREFECT_SERVER_EVENTS_ENABLED: "false"
          PREFECT_EVENTS_MESSAGING_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_PERSISTER_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_LOGGER_ENABLED: "false"
          PREFECT_SERVER_EVENTS_STREAM_OUT_ENABLED: "false"
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["prod", "cras_cas_poligonos"]

  # ---------------------------------------------------------------------------
  # primeira_infancia_carioca
  # ---------------------------------------------------------------------------
  - name: primeira_infancia_carioca-staging
    entrypoint: pipelines/arcgis/primeira_infancia_carioca/flows.py:primeira_infancia_carioca_flow
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          PREFECT_API_URL: http://prefect-api:4200/api
          MODE: staging
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["staging", "primeira_infancia_carioca"]

  - name: primeira_infancia_carioca-prod
    entrypoint: pipelines/arcgis/primeira_infancia_carioca/flows.py:primeira_infancia_carioca_flow
    schedule:
      cron: "0 * * * *"
      timezone: "America/Sao_Paulo"
    work_pool:
      name: docker-pool
      job_variables:
        networks: ["prefect_prefect-stack"]
        image: "{{ $PREFECT_DEPLOYMENT_IMAGE }}"
        env:
          MODE: prod
          PREFECT_EVENTS_ENABLED: "false"
          PREFECT_SERVER_EVENTS_ENABLED: "false"
          PREFECT_EVENTS_MESSAGING_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_PERSISTER_ENABLED: "false"
          PREFECT_SERVER_SERVICES_EVENT_LOGGER_ENABLED: "false"
          PREFECT_SERVER_EVENTS_STREAM_OUT_ENABLED: "false"
          GCP_CREDENTIALS: "{{ $GCP_CREDENTIALS }}"
          SIURB_URL: "{{ $SIURB_URL }}"
          SIURB_USER: "{{ $SIURB_USER }}"
          SIURB_PWD: "{{ $SIURB_PWD }}"
    tags: ["prod", "primeira_infancia_carioca"]
